# lab1

### 2022.10.20

解决 map 输出临时文件，reduce 读取问题。用推荐的 json 存储

今天引入进程 pid 用作 server 端记录任务分配给哪个进程，所以任务状态映射的值变化为：-1 -> 未进行的任务，-2 -> 已完成的任务，大于 0 的值 -> 正在等待 worker 反馈的值 

### 2022.10.21

解决 import cycle 的问题。修改小 bug

### 2022.10.22 

解决中间文件的问题，通过 crash 之外的其他测试。明天需要解决，worker 超时回收任务再分配

加油最后的一个问题！

### 2022.10.23

今天实验室服务器崩了，后续得用 wsl 来写

### 2022.10.24

**PASSED ALL TESTS** lab 1 完结撒花！！！

### 2022.12.6

**PASSED ALL TESTS** 突然发现 lab1 存在几个 bug

+   临时文件写入磁盘应该由 master 完成不能给 worker 完成。思考如下过程：分配的 worker 速度慢了，master 认为它挂了于是再分配新的 worker 去工作，但是之前的 worker 并没有挂，这时候怎么保证两个 worker 不冲突。这时候就需要 commit 给 master 的时候由 master 将临时文件写入磁盘。 不然两个 worker 就冲突了。
+   由上述问题引出的问题，判断当前任务完成需要完成任务 worker 的 pid 与任务分配的 worker 的 pid 相同才能算任务完成。二者 pid 不同就说明，存在了上面的问题，只信当前任务分配的 worker 进程的结果，其他的都不信。其他的 worker 由于此时只有任务完成的临时文件，没有写入磁盘，所以直接丢弃这些文件。

# lab2A

### 2022.12.16

读了系统框架，这个lab大概的意思读明白了。 Raft 到底是什么有了新的认知。
剩余问题：Heartbeat，AppendEntry 在哪里怎么实现

### 2022.12.17

今天看懂了 Heartbeat 和 AppendEntry 的问题，问就是看 lab 的 hint。对 go 的并发还是了解太少导致有时候有思路怎么写，但是不知道用 go 怎么实现。
剩下的问题：状态机的控制，还有一些细节，明天需要仔细检查一下整个逻辑。best wishes！

### 2022.12.18

今天完成了第一个测试点，接下来是网络错误测试和多 Raft 测试，还有 bug 没过，明天看一看
剩下的问题：选举出错 or 其他问题的恢复

### 2022.12.19

遇到一个问题，leader 发心跳的时候网络故障发慢了。
+   这时候其他人当leader发来心跳应该怎么办？回到 fellower
+   如果是candidate选举的时候收到前面发慢的心跳怎么办？旧心跳 term 小于现在 term，直接返回false，然后election 里面就变回 fellower。
今天改了很多bug，现在应该还剩下一点点。今天状态不好，明天再战！明天必完成！

### 2022.12.20

终于发现了bug，草！原来是ch定义，如果 `make(ch, num)` 不加 num，就是非缓冲的ch，收发数据的两端必须同时准备好才能写入ch数据。我的程序里面，一个 server 恢复之后，因为收到 heartbeat 的时候锁了 server 的raft结构，这就导致 ticker 协程没办法获取 rf.mu ，就导致接收端还没准别好，就导致写入 ch 一直等待，就死了。

### 2022.12.24

今天完成了 lab2A，千里之行始于足下！发现了前几天的bug，就是在 ticker 的理解上，前面理解错了，导致一直 bug。今天终于想明白了。完结撒花

# lab2B

### 2022.12.24

刚开始一点点，逻辑还没理顺。建议先看论文在写！

### 2022.12.25

md 一个任期只能投给一个leader票，votefor不能因为收到心跳就变成-1

### 2022.12.31

今天新冠应该是康复了很多。乱七八糟的事情也结束了七七八八，接下来目标两个周结束raft。给2023开个好头。

### 2023.1.1

剩下的部分：lastapplied 和 commitindex 两个部分没太明白，得看看论文